<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <div class="col-md-12">
     <div class="card">
        <div class="card-header">
           <div class="row">
              <div class="col-md-6" style="margin-top: 6px; margin-bottom: 3px;">
                 <span class="fa-passwd-reset fa-stack">
                 <i class="fa fa-cog fa-stack-2x"></i>
                 <i class="fa fa-user-o fa-stack-1x"></i>
                 </span>
                 <strong>Cấu hình nhóm người sử dụng</strong>
              </div>
              <div class="col-md-6" style="text-align: end; padding: 0 1% 0 21%;">
                 <div class="form-group has-search" style="margin-bottom: 0% !important;" tabindex="1">
                    <span class="fa fa-search form-control-feedback"></span>
                    <input type="text" class="form-control" #searchByKeyWordInput (keyup.enter)="searchByKeyWord($event.target.value);"
                    placeholder="Mã nhóm / Tên nhóm">
                 </div>
              </div>
           </div>
        </div>
        <div class="card-body" style="padding: 0.6rem !important;">
           <div class="form-group" style="max-width: 100%;
              max-height: 50%;border:1px solid #80808069;border-radius: 3px;padding-top: 1%; margin-bottom: 0%;" >
              <div class="col-md-12">
                 <div class="row">
                    <!-- dropdown Đối tượng -->
                    <div class="col-md-4" style="padding: 0% 15px;">
                       <div class="col-md-1 " style="float: left; padding: 2% 0 0 0">
                          <label for="">Khối:</label>
                       </div>
                       <div class="col-md-10" style="float: right;padding: 0;">
                          <ng-multiselect-dropdown #selectGradeSearch tabindex="2"
                          [placeholder]="'Danh sách khối'"
                          [data]="dropdownListDmKhoi"
                          [(ngModel)]="selectedDmKhoi"
                          [settings]="dropdownSettings"
                          (onSelect)="onItemSelect($event)"
                          (onSelectAll)="onSelectAll($event)"
                          (onDeSelect)="OnItemDeSelect($event)"
                          [ngModelOptions]="{standalone: true}"
                          (onDeSelectAll)="onItemDeSelectAll($event)">
                          </ng-multiselect-dropdown>
                          <p *ngIf="requiredGradeSearchField == false" style="color: red;">
                             Vui lòng chọn dữ liệu khối!
                          </p>
                       </div>
                    </div>
                    <!-- dropdown Đối tượng -->
                    <!-- dropdown Nhóm -->
                    <div class="col-md-4" style="padding: 0% 15px;">
                       <div class="col-md-1 " style="float: left; padding: 2% 0 0 0">
                          <label for="">Lớp:</label>
                       </div>
                       <div class="col-md-10" style="float: right;padding: 0;">
                          <ng-multiselect-dropdown  #selectClassSearch tabindex="3"
                          [placeholder]="'Danh sách lớp'"
                          [data]="dropdownListDmLop"
                          [(ngModel)]="selectedDmLop"
                          [settings]="dropdownClassSearchSettings"
                          (onSelect)="onItemDmLopSelect($event)"
                          (onDeSelect)="OnItemDeSelectClass($event)"
                          [ngModelOptions]="{standalone: true}"
                          (onSelectAll)="onSelectAllDmLop($event)"
                          (onDeSelectAll)="onItemDeSelectAllClass($event)"
                          >
                          </ng-multiselect-dropdown>
                       </div>
                    </div>
                    <!-- dropdown Nhóm -->
                    <!-- Hoạt Động -->
                    <div class="col-md-2" style="max-width: 100%; padding: 0% 15px;">
                       <div class="form-check" id="responCheckbox" style="float: right; padding: 2% 0 0 0;" tabindex="4">
                          <label class="container">
                          <input type="checkbox" checked="checked" formControlName="statusActive">
                          <span class="checkmark"></span>Hoạt động
                          </label>
                       </div>
                    </div>
                    <!-- Hoạt Động -->
                    <!-- <div class="col-md-3" style="max-width: 24%;">
                       <button type="button" class="btn btn-primary" data-toggle="button" aria-pressed="false"
                         style="float: right;" autocomplete="off" (click)="resetUserAccountForm()">

                         <i class="fa fa-refresh" aria-hidden="true"></i> Khởi tạo lại
                       </button>
                       </div> -->
                    <!-- Lọc dữ liệu -->
                    <div class="col-md-2" style="max-width: 100%; padding: 0% 15px;">
                       <button type="button" class="btn btn-primary" data-toggle="button" aria-pressed="false"
                          style="float: right;" autocomplete="off" (click)="searchByInput()" tabindex="5">
                       <i class="fa fa-filter" aria-hidden="true"></i> Lọc dữ liệu
                       </button>
                    </div>
                    <!-- Lọc dữ liệu -->
                 </div>
              </div>
              <hr style="margin: 1% 0 1% 0;">
              <div class="col-lg-12 col-md-12 col-sm-12" >
                    <div class="row">
                       <div class="col-md-6">
                          <div class="row">
                             <div class="col-md-2" style="max-width: 200%;padding: 1% 0 0 15px;">
                                <span class="hienthi">Hiển thị:</span>
                             </div>
                             <div class="col-md-3" style="margin-right: -50px !important;">
                                <select id="hienthiOption" class="form-control" (change)="perPageSelected($event.target.value)" tabindex="6">
                                   <option value="10">10</option>
                                   <option value="20">20</option>
                                   <option value="50">50</option>
                                   <option value="100">100</option>
                                </select>
                             </div>
                          </div>
                       </div>
                       <div class="col-md-6">
                          <button class="btn btn-success" type="button" data-toggle="modal" data-target="#addUserGroupConfigurationModal"
                             (click)="resetUserGroupConfigForm()" style="float: right;" tabindex="7">
                          <i class="fa fa-plus" aria-hidden="true"></i> Thêm mới
                          </button>
                       </div>
                    </div>

                 <hr style="margin: 1% 0 1% 0;">
                 <table class="table table-responsive-sm table-bordered table-striped table-sm"
                 style="text-align: center;" id="tblUserGroupConfig">
                    <thead *ngIf="headerUserGroupConfig === true">
                       <tr>
                          <th style="width: 5%;cursor: pointer;">STT</th>
                          <th (click)="sortCode()" style="cursor: pointer;width: auto;">Mã nhóm<i class="fa fa-sort"></i></th>
                          <th (click)="sortGroupName()" style="width: auto;cursor: pointer;">Tên nhóm<i class="fa fa-sort"></i></th>
                          <th style="width: auto">Khối</th>
                          <th style="width: auto">Lớp</th>
                          <th style="width: auto">Ghi chú</th>
                          <th style="width: 6%">Trạng thái</th>
                          <th style="width: 10%">Hoạt động</th>
                       </tr>
                    </thead>
                          <tbody *ngIf="userConfigData">
                             <tr class="item" *ngFor="let item of userConfigData | paginate: { itemsPerPage: countPage, currentPage: p, totalItems: totalItems }; let i = index">
                                <!-- <td>{{ (p - 1) *countPage + 1 }} - {{ currentPage * itemsPerPage }} of {{  .length }}</td> -->
                                <td style="vertical-align: inherit;"> {{ ( p - 1 ) * countPage + i + 1 }} </td>
                                <td style="vertical-align: inherit;">{{ item.code }}</td>
                                <td style="vertical-align: inherit;">{{ item.name }}</td>
                                <td style="vertical-align: inherit;">{{ item.grade_name }}</td>
                                <td style="vertical-align: inherit;">{{ item.class_name }}</td>
                                <td style="vertical-align: inherit;">{{ item.description }}</td>
                                <td style="vertical-align: middle;">
                                  <ng-template [ngIf]="item.status == 0" [ngIfElse]="notEqual">
                                    <input ng-if="item.status == 0" type="checkbox" name="status" />
                                  </ng-template>
                                  <ng-template #notEqual>
                                    <input ng-if="item.status == 1" type="checkbox" name="status" checked />
                                  </ng-template>

                                </td>
                                <td>
                                   <div class="row" style="padding: 3% 15px;">
                                      <div class="col-lg-12 col-md-12 col-sm-12">
                                         <button type="button" class="btn btn-primary" data-toggle="modal" title="Sửa"
                                            data-target="#editUserGroupConfigurationModal" (click)="getByIdUserGroupConfig(item.id)">
                                            <i class="fa fa-pencil" aria-hidden="true"></i>
                                         </button>
                                         <button type="button" id="btnXoa" class="btn btn-danger" data-toggle="tooltip" title="Xóa" (click)="deleteUserGroupConfig(item.id)">
                                          <i class="fa fa-trash" aria-hidden="true"></i>
                                          </button>
                                      </div>
                                   </div>
                                </td>
                             </tr>
                          </tbody>
                          <tbody *ngIf="checkUserConfigData === false">
                             <tr>
                                <td colspan = "8"> Dữ liệu không tồn tại
                                </td>
                             </tr>
                          </tbody>
                       </table>
                       <div class="text-right" *ngIf="userConfigData">
                          <div class="col-lg-12 col-md-12 col-sm-12">
                             <div class="row">
                                <div class="col-md-6">
                                   <div *ngFor="let item of userConfigData | paginate: { itemsPerPage: countPage, currentPage: p, totalItems: totalItems }; index as i ;last as isLast">
                                      <p *ngIf="isLast">Hiển thị <span style="font-weight: bold;">{{ (p - 1) * countPage + 1 }} - {{(p-1)*countPage+i+1}}/{{userConfigData.length}}</span> bản ghi</p>
                                   </div>
                                </div>
                                <div class="col-md-6" *ngIf="headerUserGroupConfig === true">
                                   <pagination-controls (pageChange)="p = $event"></pagination-controls>
                                </div>
                             </div>
                          </div>
                       </div>

                 <!-- Thêm mới -->
                 <div class="modal fade" id="addUserGroupConfigurationModal" data-keyboard="false" role="dialog"
                    aria-labelledby="userGroupConfigModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                       <div class="modal-content">
                          <div class="modal-header">
                             <h5 class="modal-title" id="userGroupConfigModalLabel">Thêm mới</h5>
                             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                             <span aria-hidden="true">&times;</span>
                             </button>
                          </div>
                          <div class="modal-body">
                              <div class="row">
                                 <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="form-group">
                                   <label for="code">Mã nhóm:<span style="color: red; font-size: large;">*</span></label>
                                   <input class="form-control" type="text" name="text-input" formControlName="code"
                                      placeholder="Vui lòng nhập mã nhóm" [ngClass]="{ 'is-invalid': submitted && f.code.errors }" >
                                   <div *ngIf="submitted && f.code.errors" class="invalid-feedback">
                                      <div *ngIf="f.code.errors.required">Mã nhóm không được để trống</div>
                                      <div *ngIf="f.code.errors.minlength">Mã nhóm không được nhỏ hơn 6 ký tự</div>
                                      <div *ngIf="f.code.errors.maxlength">Mã nhóm không được lớn hơn 100 ký tự</div>
                                   </div>
                                </div>
                                 </div>
                                 <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="form-group">
                                   <label for="name">Tên nhóm:<span style="color: red; font-size: large;">*</span></label>
                                   <input class="form-control" type="text" name="text-input" formControlName="name"
                                     placeholder="Vui lòng nhập Tên nhóm" [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                                   <div *ngIf="submitted && f.name.errors" class="invalid-feedback">
                                     <div *ngIf="f.name.errors.required">Tên nhóm không được để trống</div>
                                     <div *ngIf="f.name.errors.minlength">Tên nhóm không được nhỏ hơn 6 ký tự</div>
                                     <div *ngIf="f.name.errors.maxlength">Tên nhóm không được lớn hơn 100 ký tự</div>
                                   </div>
                                </div>
                                 </div>
                              </div>
                              <div class="row">
                                 <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="form-group">
                                   <label for="grade">Khối:</label>
                                   <ng-multiselect-dropdown #selectGradeInsert
                                   [placeholder]="'Danh sách khối'"
                                   [data]="ddlGradeInsert"
                                   [(ngModel)]="selectedGradesInsert"
                                   [settings]="ddlInsertGradeSettings"
                                   (onSelect)="onGradeSelectInsert($event)"
                                   [ngModelOptions]="{standalone: true}"
                                   (onDeSelect)="OnGradeDeSelectInsert($event)"
                                   >
                                   </ng-multiselect-dropdown>
                                   <!-- <p *ngIf="reqGradeInsertField == false" style="color: red;font-size: 11px;">
                                      Vui lòng chọn dữ liệu khối!
                                   </p> -->
                                </div>
                                 </div>
                                 <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="form-group">
                                   <label for="class">Lớp:</label>
                                   <ng-multiselect-dropdown #selectClassInsert
                                   [placeholder]="'Danh sách lớp'"
                                   [data]="ddlClassInsert"
                                   [settings]="ddlInsertGradeSettings"
                                   (onSelect)="onClassSelectInsert($event)"
                                   (onDeSelect)="onClassDeSelectInsert($event)"
                                   >
                                   </ng-multiselect-dropdown>
                                   <!-- <p *ngIf="reqClassInsertField == false" style="color: red;font-size: 11px;">
                                      Vui lòng chọn dữ liệu lớp!
                                   </p> -->
                                </div>
                                 </div>
                              </div>
                             <div class="col-lg-12 col-md-12 col-sm-12" style="padding: 0%;">
                                <div class="form-group">
                                   <label for="grade">Ghi chú:</label>
                                   <textarea cols="100" rows="5" class="form-control" formControlName="description"
                                      placeholder="Ghi chú" ></textarea>
                                </div>
                             </div>
                          </div>
                          <div class="modal-footer">
                             <button type="button" class="btn btn-success" (click)="addUserGroupConfig()"><i class="fa fa-plus" aria-hidden="true"></i>Thêm</button>
                             <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-sign-out" aria-hidden="true"></i>Thoát</button>
                          </div>
                       </div>
                    </div>
                 </div>
                 <!-- Sửa -->
                 <div class="modal fade" id="editUserGroupConfigurationModal"  [ngStyle]="{display: userConfigGetById ? 'block':'none'}"
                    role="dialog" aria-labelledby="userGroupConfigModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                       <div class="modal-content">
                          <div class="modal-header">
                             <h5 class="modal-title" id="userGroupConfigModalLabel">Cập nhật</h5>
                             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                             <span aria-hidden="true">&times;</span>
                             </button>
                          </div>
                          <div class="modal-body">
                             <div class="row">
                                 <div class="col-lg-6 col-md-6 col-sm-6">
                                 <div class="form-group">
                                    <label for="code">Mã nhóm:</label>
                                    <input [(ngModel)] = "ddCodeGroup" value="{{ddCodeGroup}}" class="form-control" formControlName="code" type="text" name="text-input" tabindex="12"
                                       placeholder="Vui lòng nhập mã nhóm"  disabled>
                                    <!-- <div *ngIf="submitted && f.code.errors" class="invalid-feedback">
                                       <div *ngIf="f.code.errors.required">Mã nhóm không được để trống</div>
                                       <div *ngIf="f.code.errors.minlength">Mã nhóm không được nhỏ hơn 2 ký tự</div>
                                       <div *ngIf="f.code.errors.maxlength">Mã nhóm không được lớn hơn 100 ký tự</div>
                                    </div> -->
                                 </div>
                                 </div>
                                 <div class="col-lg-6 col-md-6 col-sm-6">
                                 <div class="form-group">
                                    <label for="name">Tên nhóm:<span style="color: red; ">*</span></label>
                                    <input [(ngModel)] = "ddNameGroup" value="{{ddNameGroup}}" class="form-control" formControlName="name" type="text" name="text-input" tabindex="13"
                                       placeholder="Vui lòng nhập tên nhóm" [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                                    <div *ngIf="submitted && f.name.errors" class="invalid-feedback">
                                       <div *ngIf="f.name.errors.required">Tên nhóm không được để trống</div>
                                       <div *ngIf="f.name.errors.minlength">Tên nhóm không được nhỏ hơn 6 ký tự</div>
                                       <div *ngIf="f.name.errors.maxlength">Tên nhóm không được lớn hơn 100 ký tự</div>
                                    </div>
                                 </div>
                                 </div>
                             </div>
                             <div class="row">
                              <div class="col-lg-6 col-md-6 col-sm-6">
                                 <div class="form-group">
                                    <label for="grade">Khối:</label>
                                    <ng-multiselect-dropdown #selectGradeUpdate  tabindex="14"
                                    [placeholder]="'Danh sách khối'"
                                    [data]="ddlGradeUpdate"
                                    [(ngModel)]="selectedGradesUpdate"
                                    [settings]="ddlUpdateGradeSettings"
                                    (onSelect)="onGradeSelectUpdate($event)"
                                    [ngModelOptions]="{standalone: true}"
                                    (onDeSelect)="OnGradeDeSelectUpdate($event)"
                                    >
                                    </ng-multiselect-dropdown>
                                    <!-- <p *ngIf="reqGradeUpdateField == false" style="color: red;font-size: 11px;">
                                       Vui lòng chọn dữ liệu khối!
                                    </p> -->
                                 </div>
                              </div>
                              <div class="col-lg-6 col-md-6 col-sm-6">
                                 <div class="form-group">
                                    <label for="class">Lớp:</label>
                                    <ng-multiselect-dropdown #selectClassUpdate  tabindex="14"
                                    [placeholder]="'Danh sách lớp'"
                                    [data]="ddlClassUpdate"
                                    [(ngModel)]="selectedClassUpdate"
                                    [settings]="ddlUpdateClassSettings"
                                    [ngModelOptions]="{standalone: true}"
                                    (onSelect)="onClassSelectUpdate($event)"
                                    (onDeSelect)="onClassDeSelectUpdate($event)"
                                    >
                                    </ng-multiselect-dropdown>
                                    <!-- <p *ngIf="reqClassUpdateField == false" style="color: red;font-size: 11px;">
                                       Vui lòng chọn dữ liệu khối!
                                    </p> -->
                                 </div>
                              </div>
                             </div>
                            
                             <div class="col-lg-12 col-md-12 col-sm-12" style="padding: 0%;">
                                <div class="form-group">
                                   <label for="grade">Ghi chú:</label>
                                   <textarea [(ngModel)]="descriptionValue" cols="50" rows="5" class="form-control" formControlName="description"
                                      placeholder="Ghi chú">{{descriptionValue}}</textarea>
                                </div>
                             </div>
                             <div class="col-lg-12 col-md-12 col-sm-12" style="padding: 0%;">
                                <div class="form-group">
                                   <label for="status">Trạng thái:</label>
                                   <br>
                                   <label class="checkbox">
                                    <input type="checkbox" formControlName="checkBox" checked="checked"/>
                                   <span class="default"></span>
                                   </label>
                                </div>
                             </div>
                          </div>
                          <div class="modal-footer">
                             <button type="button" class="btn btn-primary"
                                (click)="updateUserGroupConfig(userConfigGetById.id)"><i class="fa fa-history" aria-hidden="true"></i>Cập nhật</button>
                             <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-sign-out" aria-hidden="true"></i>Thoát</button>
                          </div>
                       </div>
                    </div>
                 </div>
              </div>
              <div class="card-footer respon2">
                 <div class="form-group" style="margin-bottom: 0rem !important;">
                    <form action="" method="POST" enctype="multipart/form-data">
                       <section class="section-preview">
                          <div class="col-lg-12 col-md-12 col-sm-12">
                             <div class="row">
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                   <button class="btn btn-primary btn-sm respon1" type="button" (click)="downloadSampleFile()" tabindex="8" style="max-width: 120px; width: 120px;">
                                   <i class="fa fa-download"></i> Tải file mẫu
                                   </button>
                                   &nbsp;
                                   <button class="btn btn-primary btn-sm respon" id="btnR" type="button" (click)="exportFile();" tabindex="9" style="max-width: 120px; width: 120px;">
                                   <i class="fa fa-save"></i> Xuất ra tệp
                                   </button>
                                   &nbsp;
                                   <button id="btnImport" class="btn btn-primary btn-sm respon" type="button" (click)="importFile();" tabindex="10" style="max-width: 120px; width: 120px;">
                                   <i class="fa fa-save"></i> Nhập từ tệp
                                   </button>
                                   &nbsp;
                                   <input class="form-control vendor_logo_hide" type="file" #fileInput name="import_excel" id="Uploadfile" tabindex="11"
                                      accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" placeholder="Vui lòng chọn file"/>
                                   <span class='file_placeholder' >Không có tệp nào được chọn</span>
                                </div>
                             </div>
                          </div>
                       </section>
                    </form>
                 </div>
              </div>
           </div>
        </div>
     </div>
  </div>
  </form>
